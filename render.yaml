# render.yaml
# Production deployment configuration for Render.com

services:
  # FastAPI Web Service
  - type: web
    name: tulkka-ai
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn src.api.app:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: N8N_WEBHOOK_URL
        sync: false
      - key: ASSEMBLYAI_API_KEY
        sync: false
      - key: ENVIRONMENT
        value: "production"
      - key: LOG_LEVEL
        value: "INFO"
      - key: MYSQL_HOST
        sync: false
      - key: MYSQL_PORT
        value: "3306"
      - key: MYSQL_USER
        sync: false
      - key: MYSQL_PASSWORD
        sync: false
      - key: MYSQL_DATABASE
        value: "tulkka9"

  # Background Worker Service (Zoom transcript processor)
  - type: worker
    name: tulkka-worker
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: python -m src.workers.zoom_processor
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: WORKER_POLL_INTERVAL_SECONDS
        value: "60"
      - key: WORKER_BATCH_SIZE
        value: "10"
      - key: WORKER_MAX_RETRIES
        value: "5"
      - key: LOG_LEVEL
        value: "INFO"

  # Class Monitor Service (MySQL classes watcher)
  - type: worker
    name: tulkka-class-monitor
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: python -m src.workers.class_monitor
    envVars:
      - key: MYSQL_HOST
        sync: false
      - key: MYSQL_PORT
        value: "3306"
      - key: MYSQL_USER
        sync: false
      - key: MYSQL_PASSWORD
        sync: false
      - key: MYSQL_DATABASE
        value: "tulkka9"
      - key: N8N_WEBHOOK_URL
        sync: false
      - key: WORKER_POLL_INTERVAL_SECONDS
        value: "60"
      - key: LOG_LEVEL
        value: "INFO"
